stages:
  - report

report_status_to_github:
  stage: report
  image: curlimages/curl:latest
  tags:
    - prod-web3-k8s
  script:
    - echo "Reporting status to GitHub..."
    - |
      STATE=$( [[ "$CI_JOB_STATUS" == "success" ]] && echo "success" || echo "failure" )
      curl -s -X POST \
        -H "Authorization: token $GITHUB_TOKEN" \
        -H "Accept: application/vnd.github.v3+json" \
        https://api.github.com/repos/wangchunsheng-ops/testgithub/statuses/$CI_COMMIT_SHA \
        -d "{\"state\":\"$STATE\",\"context\":\"gitlab-ci\",\"description\":\"$STATE via GitLab CI\",\"target_url\":\"$CI_PROJECT_URL/-/jobs/$CI_JOB_ID\"}"
  when: always
