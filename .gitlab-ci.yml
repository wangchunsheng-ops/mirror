stages:
  - build
  - report

# 简单构建步骤
build:
  stage: build
  script:
    - echo "Building..."

# 始终报告状态回 GitHub
report_status_to_github:
  stage: report
  image: curlimages/curl:latest
  script:
    - echo "Reporting to GitHub..."
    - |
      STATE=$( [[ "$CI_JOB_STATUS" == "success" ]] && echo "success" || echo "failure" )
      curl -s -X POST \
        -H "Authorization: token $GITHUB_TOKEN" \
        -H "Accept: application/vnd.github.v3+json" \
        https://api.github.com/repos/wangchunsheng-ops/testgithub/statuses/$CI_COMMIT_SHA \
        -d "{\"state\":\"$STATE\",\"context\":\"gitlab-ci\",\"description\":\"$STATE via GitLab CI\",\"target_url\":\"$CI_PROJECT_URL/-/jobs/$CI_JOB_ID\"}"
  when: always
  needs: [build]
